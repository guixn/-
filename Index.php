<?php
/*
 本代码由 PHP代码加密工具 Xend [旗舰版](Build 5.05.75) 创建
 创建时间 2025-03-17 09:11:24
 技术支持 QQ:30370740 Mail:support@phpXend.com
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace app\admin\controller;use app\common\controller\Backend;use think\Config;use think\Hook;use think\Session;use think\Validate;class Index extends Backend{protected $noNeedLogin=["\x6C\x6F\x67\x69\x6E"];protected $noNeedRight=["\x69\x6E\x64\x65\x78","\x6C\x6F\x67\x6F\x75\x74"];protected $layout="";public function _initialize(){parent::_initialize();$this->request->filter('trim,strip_tags,htmlspecialchars');}public function index(){unset($X2vtI8D);$X2vtI8D=['adminskin'=>"/^skin\-([a-z\-]+)\$/i",'multiplenav'=>"/^(0|1)\$/",'multipletab'=>"/^(0|1)\$/",'show_submenu'=>"/^(0|1)\$/"];$cookieArr=$X2vtI8D;foreach($cookieArr as $key=>$regex){unset($X2vtI8D);$X2vtI8D=$this->request->cookie($key);$cookieValue=$X2vtI8D;$X2v8D=!is_null($cookieValue);$X2v8E=(bool)$X2v8D;if($X2v8E)goto X2veWjgx3;goto X2vldMhx3;X2veWjgx3:$X2v8E=(bool)preg_match($regex,$cookieValue);goto X2vx2;X2vldMhx3:X2vx2:if($X2v8E)goto X2veWjgx4;goto X2vldMhx4;X2veWjgx4:$X2vvP8D='fastadmin.' . $key;config($X2vvP8D,$cookieValue);goto X2vx1;X2vldMhx4:X2vx1:}unset($X2vtI8D);$X2vtI8D=$this->auth->getSidebar(['dashboard'=>'hot','addon'=>['new','red','badge'],'auth/rule'=>__('Menu'),],$this->view->site['fixedpage']);list($menulist,$navlist,$fixedmenu,$referermenu)=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=$this->request->request('action');$action=$X2vtI8D;if($this->request->isPost())goto X2veWjgx6;goto X2vldMhx6;X2veWjgx6:$X2v8D=$action=='refreshmenu';if($X2v8D)goto X2veWjgx8;goto X2vldMhx8;X2veWjgx8:$this->success('',null,['menulist'=>$menulist,'navlist'=>$navlist]);goto X2vx7;X2vldMhx8:X2vx7:goto X2vx5;X2vldMhx6:X2vx5:$this->assignconfig('cookie',['prefix'=>config('cookie.prefix')]);$this->view->assign('menulist',$menulist);$this->view->assign('navlist',$navlist);$this->view->assign('fixedmenu',$fixedmenu);$this->view->assign('referermenu',$referermenu);$this->view->assign('title',__('Home'));return $this->view->fetch();}public function login(){unset($X2vtI8D);$X2vtI8D=$this->request->get('url','','url_clean');$url=$X2vtI8D;if($url)goto X2veWjgxa;goto X2vldMhxa;X2veWjgxa:$X2v8D=$url;goto X2vx9;X2vldMhxa:$X2v8D='index/index';X2vx9:unset($X2vtI8E);$X2vtI8E=$X2v8D;$url=$X2vtI8E;if($this->auth->isLogin())goto X2veWjgxc;goto X2vldMhxc;X2veWjgxc:$this->success(__("You've logged in, do not login again"),$url);goto X2vxb;X2vldMhxc:X2vxb:unset($X2vtI8D);$X2vtI8D=24;$keeyloginhours=$X2vtI8D;if($this->request->isPost())goto X2veWjgxe;goto X2vldMhxe;X2veWjgxe:unset($X2vtI8D);$X2vtI8D=$this->request->post('username');$username=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=$this->request->post('password','',null);$password=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=$this->request->post('keeplogin');$keeplogin=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=$this->request->post('__token__');$token=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=['username'=>'require|length:3,30','password'=>'require|length:3,30','__token__'=>'require|token',];$rule=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=['username'=>$username,'password'=>$password,'__token__'=>$token,];$data=$X2vtI8D;if(Config::get('fastadmin.login_captcha'))goto X2veWjgxg;goto X2vldMhxg;X2veWjgxg:unset($X2vtI8D);$X2vtI8D='require|captcha';$rule['captcha']=$X2vtI8D;unset($X2vtI8D);$X2vtI8D=$this->request->post('captcha');$data['captcha']=$X2vtI8D;goto X2vxf;X2vldMhxg:X2vxf:$X2v8D=new Validate($rule,[],['username'=>__('Username'),'password'=>__('Password'),'captcha'=>__('Captcha')]);unset($X2vtI8E);$X2vtI8E=$X2v8D;$validate=$X2vtI8E;unset($X2vtI8D);$X2vtI8D=$validate->check($data);$result=$X2vtI8D;$X2v8D=!$result;if($X2v8D)goto X2veWjgxi;goto X2vldMhxi;X2veWjgxi:$this->error($validate->getError(),$url,['token'=>$this->request->token()]);goto X2vxh;X2vldMhxi:X2vxh:if($keeplogin)goto X2veWjgxk;goto X2vldMhxk;X2veWjgxk:$X2vvP8D=$keeyloginhours*3600;$X2vvP8E=$X2vvP8D;goto X2vxj;X2vldMhxk:$X2vvP8E=0;X2vxj:unset($X2vtI8F);$X2vtI8F=$this->auth->login($username,$password,$X2vvP8E);$result=$X2vtI8F;$X2v8D=$result===true;if($X2v8D)goto X2veWjgxm;goto X2vldMhxm;X2veWjgxm:Hook::listen("admin_login_after",$this->request);$this->success(__('Login successful'),$url,['url'=>$url,'id'=>$this->auth->id,'username'=>$username,'avatar'=>$this->auth->avatar]);goto X2vxl;X2vldMhxm:unset($X2vtI8D);$X2vtI8D=$this->auth->getError();$msg=$X2vtI8D;if($msg)goto X2veWjgxo;goto X2vldMhxo;X2veWjgxo:$X2v8D=$msg;goto X2vxn;X2vldMhxo:$X2v8D=__('Username or password is incorrect');X2vxn:unset($X2vtI8E);$X2vtI8E=$X2v8D;$msg=$X2vtI8E;$this->error($msg,$url,['token'=>$this->request->token()]);X2vxl:goto X2vxd;X2vldMhxe:X2vxd:if($this->auth->autologin())goto X2veWjgxq;goto X2vldMhxq;X2veWjgxq:Session::delete("referer");$this->redirect($url);goto X2vxp;X2vldMhxq:X2vxp:unset($X2vtI8D);$X2vtI8D=Config::get('fastadmin.login_background');$background=$X2vtI8D;if($background)goto X2veWjgxu;goto X2vldMhxu;X2veWjgxu:$X2v8D=stripos($background,'http')===0;if($X2v8D)goto X2veWjgxs;goto X2vldMhxs;X2veWjgxs:$X2v8E=$background;goto X2vxr;X2vldMhxs:$X2v8F=config('site.cdnurl') . $background;$X2v8E=$X2v8F;X2vxr:$X2v8G=$X2v8E;goto X2vxt;X2vldMhxu:$X2v8G='';X2vxt:unset($X2vtI8H);$X2vtI8H=$X2v8G;$background=$X2vtI8H;$this->view->assign('keeyloginhours',$keeyloginhours);$this->view->assign('background',$background);$this->view->assign('title',__('Login'));Hook::listen("admin_login_init",$this->request);return $this->view->fetch();}public function logout(){if($this->request->isPost())goto X2veWjgxw;goto X2vldMhxw;X2veWjgxw:$this->auth->logout();Hook::listen("admin_logout_after",$this->request);$this->success(__('Logout successful'),'index/login');goto X2vxv;X2vldMhxw:X2vxv:$X2v8D="<form id='logout_submit' name='logout_submit' action='' method='post'>" . token();$X2v8E=$X2v8D . "<input type='submit' value='ok' style='display:none;'></form>";unset($X2vtI8F);$X2vtI8F=$X2v8E;$html=$X2vtI8F;$html=$html."<script>document.forms['logout_submit'].submit();</script>";$X2vnW8D=$html;return $html;}}
?>